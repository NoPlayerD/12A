<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ödev Takip Sayfası</title>

  <!-- CSS 'Bootstrap' -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Lib 'public-google-sheets-parser' -->
  <script src="https://cdn.jsdelivr.net/npm/public-google-sheets-parser@latest"></script>
  
  <style>
    body {
      background-color: #f8f9fa;
    }
    .table th, .table td {
      vertical-align: middle;
      text-align: center;
    }
    .header {
      margin: 30px 0;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Ödevler</h1>
      <!-- p>Sınıf ödevlerinizi takip etmek için aşağıdaki tabloyu kullanabilirsiniz.</p -->
    </div>

    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th>Ders</th>
          <th>Ödev</th>
          <th>Son Tarih</th>
          <th>Sorumlu</th>
          <th>Durum</th>
        </tr>
      </thead>
      <tbody id="table-body">
        <!-- data* -->
      </tbody>
    </table>
  </div>


  <script>
    const spreadsheetId = "1GKPTp-sU5q6Aqmn80T7uq4RjsSpgoh8YzjqRWbVcGs4";

    const parser = new PublicGoogleSheetsParser(spreadsheetId);

	function formatDate(dateValue) {
	  if (!dateValue) return "";

	  // "Date(YYYY,MM,DD)" formatını kontrol et
	  const dateMatch = /^Date\((\d{4}),\s*(\d{1,2}),\s*(\d{1,2})\)$/.exec(dateValue);
	  let date;

	  if (dateMatch) {
		const [_, year, month, day] = dateMatch;
		date = new Date(Number(year), Number(month), Number(day)); // Ay 0 tabanlı
	  } else {
		date = new Date(dateValue);
	  }

	  // Geçerli değilse orijinal metni döndür
	  if (isNaN(date.getTime())) return dateValue;

	  // Seçtiğimiz format: "10 Ekim - Cuma"
	return (
	  date.toLocaleDateString("tr-TR", {
		day: "numeric",
		month: "long"
	  }) +
	  " - " +
	  date.toLocaleDateString("tr-TR", {
		weekday: "long"
	  })
	);
	}


    function getBadgeClass(status) {
      if (!status) return "secondary";
      switch(status.trim().toLowerCase()) {
        case "bekliyor": return "warning text-dark";
        case "teslim edildi": return "success";
        case "geç kaldı": return "danger";
        default: return "secondary";
      }
    }

    parser.parse()
      .then(data => {
        const tbody = document.getElementById('table-body');
        tbody.innerHTML = "";

        data.forEach(item => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${item.ders || ""}</td>
            <td>${item.ödev || ""}</td>
            <td>${formatDate(item.sontarih)}</td>
            <td>${item.sorumlu || ""}</td>
            <td><span class="badge bg-${getBadgeClass(item.durum)}">${item.durum || ""}</span></td>
          `;
          tbody.appendChild(tr);
        });
      })
      .catch(err => {
        console.error("Google Sheets verisi çekilirken hata:", err);
        const tbody = document.getElementById('table-body');
        tbody.innerHTML = `<tr><td colspan="5" class="text-danger">Veri yüklenemedi.</td></tr>`;
      });
  </script>

</body>
</html>
